"use strict";angular.module("sbAdminApp",["chartService"]).controller("scheduleCtrl",["$scope","$rootScope","$state","baseService","leafService","chartService",function(e,i,r,t,a,c){e.displayed=[],e.sp={},e.tableState={},e.callServer=function(i){t.initTable(e,i,t.api.programSchedule+"getProgramSchedulePageList")},e.showSchedule=function(e){t.showSchedule(e,2,c)},e.del=function(i){t.confirm("删除","确定删除排期："+i.name+"?",function(r,a){a.isPosting=!0,t.postData(t.api.programSchedule+"deleteProgramScheduleById",{id:i.id},function(i){r.close(),t.alert("删除成功","success"),e.callServer(e.tableState)})})},e.submitCheck=function(i){t.confirm("提交审核","是否提交审核？",function(r,a){a.isPosting=!0,t.postData(t.api.programSchedule+"submitProgramScheduleById",{id:i.id},function(i){r.close(),t.alert("提交成功","success"),e.callServer(e.tableState)})})},e.edit=function(e){r.go("dashboard.scheduleCreate",{id:e.id})},e.saveAs=function(e){r.go("dashboard.scheduleCreate",{id:e.id,type:"saveAs"})},e.sendDown=function(e){t.confirmDialog(720,"排期发布",e,"tpl/terminal_schedule.html",function(i,r){var a="";a=r.ids.join(","),a.length?t.confirm("节目操作","确定在选中的终端上发布排期?",function(i,r){r.isPosting=!0,t.postData(t.api.programSchedule+"scheduleManage_sendCommand",{pid:e.id,type:1,tids:a},function(e){i.close(),t.alert("下发成功","success",!0)})}):t.alert("请至少勾选一个设备再进行操作","warning",!0)},function(e){e.displayed=[],e.sp={},e.ids=[],e.currentGroup=i.rootGroup,e.sp.oid=e.currentGroup.id,e.currentLeaf={},e.currentLeaf.id="",e.sp.gid="",e.tableState={},e.callServer=function(i){t.initTable(e,i,t.api.programSchedule+"scheduleManage_getAllOkTerminalList")},e.$on("emitGroupLeaf",function(i,r,t){e.sp.oid==r.id&&e.sp.gid==t.id||(e.currentGroup=r,e.sp.oid=r.id,e.sp.gid=t.id,e.callServer(e.tableState))}),e.checkAll=function(i){if(e.ids=[],$(i.currentTarget).is(":checked"))for(var r=0;r<e.displayed.length;r++)e.ids.push(e.displayed[r].id);else e.ids=[]},e.checkThis=function(i,r){$(r.currentTarget).is(":checked")?e.ids.push(i.id):e.ids=t.removeAry(e.ids,i.id)},e.showPlay=function(e){t.showProgram(e)}})},e.sendCommandStopProgram=function(e){t.confirmDialog(720,"播放管理",e,"tpl/terminal_schedulePlay.html",function(i,r){var a="";a=r.ids.join(","),a.length?t.confirm("节目操作","确定在该设备上停播选中节目?",function(i,r){r.isPosting=!0,t.postData(t.api.programSchedule+"scheduleManage_sendCommand",{tids:a,type:0,pid:e.id},function(e){i.close(),t.confirmAlert("信息提示","操作成功","success","终端命令执行成功后，将停播此排期，同时不显示在终端列表中~","离线终端需上线后再执行命令，半小时内重复命令为您自动过滤")})}):t.alert("请至少勾选一个终端再进行操作","warning",!0)},function(r){r.displayed=[],r.sp={},r.ids=[],r.currentGroup=i.rootGroup,r.sp.oid=r.currentGroup.id,r.currentLeaf={},r.currentLeaf.id="",r.sp.gid="",r.tableState={},r.showType=0,r.sp.pid=e.id,r.callUrl=t.api.programSchedule+"getProgramSchedulePlayPageByPid",r.callServer=function(e){t.initTable(r,e,r.callUrl)},r.initTable=function(){switch(r.sp.status="",r.sp.resolution="",r.showType){case 0:r.callUrl=t.api.programSchedule+"getProgramSchedulePlayPageByPid";break;case 1:r.callUrl=t.api.programSchedule+"getProgramScheduleCommandPengdingPageByPid"}r.currentGroup=i.rootGroup,r.sp.oid=r.currentGroup.id,r.currentLeaf={},r.currentLeaf.id="",r.sp.gid="",r.callServer(r.tableState)},r.$on("emitGroupLeaf",function(e,i,t){r.sp.oid==i.id&&r.sp.gid==t.id||(r.currentGroup=i,r.sp.oid=i.id,r.sp.gid=t.id,r.callServer(r.tableState))}),r.checkAll=function(e){if(r.ids=[],$(e.currentTarget).is(":checked"))for(var i=0;i<r.displayed.length;i++)r.ids.push(r.displayed[i].tid);else r.ids=[]},r.checkThis=function(e,i){$(i.currentTarget).is(":checked")?r.ids.push(e.tid):r.ids=t.removeAry(r.ids,e.tid)},r.switchTab=function(e){r.showType!=e&&(r.showType=e,r.initTable())}})}}]);
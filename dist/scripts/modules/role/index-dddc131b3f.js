"use strict";angular.module("sbAdminApp",[]).controller("roleCtrl",["$scope","$rootScope","baseService",function(e,i,t){function s(i){e.permList?i():t.getJson(t.api.role+"getPermsList",{},function(t){e.permList=t,i()})}function n(i){var t=[];if(i&&i.length>0)for(var s=i.split(","),n=0;n<e.permList.length;n++)for(var r=0;r<s.length;r++)s[r]==e.permList[n].id&&t.push({id:e.permList[n].id,pId:e.permList[n].pid,name:e.permList[n].name});else for(var n=0;n<e.permList.length;n++)t.push({id:e.permList[n].id,pId:e.permList[n].pid,name:e.permList[n].name});return t}e.displayed=[],e.sp={},e.tableState={},e.callServer=function(i){t.initTable(e,i,t.api.role+"getRolePageList")},e.checkPerms=function(e){s(function(){t.confirmDialog(540,"查看权限",{set:1},"tpl/perms_set.html",function(e,i){},function(i){i.zTreeSetting={zNodes:n(e.fids),isSort:!1,isSet:!1,isCheck:!1,selectedNodes:[]}})})},e.save=function(i){var r={id:i?i.id:"",name:i?i.name:"",fids:i?i.fids:"",remark:i?i.remark:""};t.confirmDialog(540,i?"编辑角色":"添加角色",r,"tpl/role_save.html",function(s,n){n.isShowMessage=!1,n.modalForm.$valid?n.fids&&n.fids.length?(n.data.fids=n.fids.join(","),n.isPosting=!0,t.postData(t.api.role+"saveRole",n.data,function(){s.close(),t.alert(i?"修改成功":"添加成功","success"),e.callServer(e.tableState)})):t.alert("请先选择权限","warning",!0):n.isShowMessage=!0},function(e){e.fids||(e.fids=i?i.fids.split(","):[]),e.checkPerms=function(){s(function(){t.confirmDialog(540,"权限设置",{set:2},"tpl/perms_set.html",function(i,s){for(var n=$.fn.zTree.getZTreeObj("modalZtree"),r=n.getCheckedNodes(!0),o=[],a=0;a<r.length;a++)o.push(r[a].id);o.length>0?(s.closeThisDialog(),e.fids=o):t.alert("请先选择权限","warning",!0)},function(i){i.zTreeSetting={zNodes:n(),isSort:!1,isSet:!1,isCheck:!0,selectedNodes:e.fids}})})}})},e.del=function(i){t.confirm("删除","您确定删除角色："+i.name+"?",function(s,n){n.isPosting=!0,t.postData(t.api.role+"deleteRole",{rid:i.id},function(){s.close(),t.alert("删除成功","success"),e.callServer(e.tableState)})})}}]);
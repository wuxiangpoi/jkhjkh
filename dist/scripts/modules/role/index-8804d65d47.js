"use strict";angular.module("sbAdminApp",[]).controller("roleCtrl",["$scope","$rootScope","baseService",function(e,t,i){function s(t){e.permList?t():i.getJson(i.api.role+"getPermsList",{},function(i){e.permList=i,t()})}function n(t){var i=[];if(t&&t.length>0)for(var s=t.split(","),n=0;n<e.permList.length;n++)for(var r=0;r<s.length;r++)s[r]==e.permList[n].id&&i.push({id:e.permList[n].id,pId:e.permList[n].pid,name:e.permList[n].name});else for(var n=0;n<e.permList.length;n++)i.push({id:e.permList[n].id,pId:e.permList[n].pid,name:e.permList[n].name});return i}e.displayed=[],e.sp={},e.tableState={},e.callServer=function(t){i.initTable(e,t,i.api.role+"getRolePageList")},e.initPage=function(){e.tableState.pagination.start=0,e.callServer(e.tableState)},e.checkPerms=function(e){s(function(){i.confirmDialog(540,"查看权限",{set:1},"tpl/perms_set.html",function(e,t){},function(t){t.zTreeSetting={zNodes:n(e.fids),isSort:!1,isSet:!1,isCheck:!1,selectedNodes:[]}})})},e.save=function(t){var r={id:t?t.id:"",name:t?t.name:"",fids:t?t.fids:"",remark:t?t.remark:""};i.confirmDialog(540,t?"编辑角色":"添加角色",r,"tpl/role_save.html",function(s,n){n.isShowMessage=!1,n.modalForm.$valid?n.fids&&n.fids.length?(n.data.fids=n.fids.join(","),n.isPosting=!0,i.postData(i.api.role+"saveRole",n.data,function(){s.close(),i.alert(t?"修改成功":"添加成功","success"),e.callServer(e.tableState)})):i.alert("请先选择权限","warning",!0):n.isShowMessage=!0},function(e){e.fids||(e.fids=t?t.fids.split(","):[]),e.checkPerms=function(){s(function(){i.confirmDialog(540,"权限设置",{set:2},"tpl/perms_set.html",function(t,s){for(var n=$.fn.zTree.getZTreeObj("modalZtree"),r=n.getCheckedNodes(!0),o=[],a=0;a<r.length;a++)o.push(r[a].id);o.length>0?(s.closeThisDialog(),e.fids=o):i.alert("请先选择权限","warning",!0)},function(t){t.zTreeSetting={zNodes:n(),isSort:!1,isSet:!1,isCheck:!0,selectedNodes:e.fids}})})}})},e.del=function(t){i.confirm("删除","您确定删除角色："+t.name+"?",function(s,n){n.isPosting=!0,i.postData(i.api.role+"deleteRole",{rid:t.id},function(){s.close(),i.alert("删除成功","success"),e.callServer(e.tableState)})})}}]);
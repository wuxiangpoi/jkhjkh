"use strict";angular.module("sbAdminApp",[]).controller("auserCtrl",["$scope","$rootScope","baseService",function(e,s,a){e.displayed=[],e.sp={},e.tableState={},e.currentGroup=s.rootGroup,e.sp.oid=e.currentGroup.id,e.callServer=function(s){a.initTable(e,s,a.api.installUser+"getInstallUserPageList")},e.initPage=function(){e.callServer(e.tableState)},e.$on("emitGroupLeaf",function(s,a){e.sp.oid!=a.id&&(e.currentGroup=a,e.sp.oid=a.id,e.initPage())}),e.save=function(s){var t={id:s?s.id:"",phone:s?s.phone:"",password:s?s.password:"",name:s?s.name:"",oid:s?s.oid:""};a.confirmDialog(540,s?"编辑账号":"添加账号",t,"tpl/auser_save.html",function(t,o){if(o.isShowMessage=!1,o.modalForm.$valid){var i={id:s?s.id:"",phone:o.data.phone,password:o.data.password,name:o.data.name,oid:o.currentGroup.id};s||(i.password=a.md5_pwd(i.password)),o.isPosting=!0,a.postData(a.api.installUser+"saveInstallUser",i,function(){t.close(),a.alert(s?"修改成功":"添加成功","success"),e.callServer(e.tableState)})}else o.isShowMessage=!0},function(e){e.$on("emitGroupLeaf",function(s,a,t){e.currentGroup=a,e.currentGroup.id=a.id})})},e.resetPwd=function(s){a.confirmDialog(540,"重置密码",{},"tpl/reset_password.html",function(t,o){o.modalForm.$valid?(o.isPosting=!0,a.postData(a.api.installUser+"resetInstallUserPassword",{id:s.id,password:a.md5_pwd(o.data.password)},function(){t.close(),a.alert("修改成功","success"),e.callServer(e.tableState)})):o.isShowMessage=!0})},e.del=function(s){a.confirm("删除","您确定删除安装人员："+s.name+"?",function(t,o){o.isPosting=!0,a.postData(a.api.installUser+"deleteInstallUser",{id:s.id},function(s){t.close(),a.alert("删除成功","success"),e.callServer(e.tableState)})})}}]);
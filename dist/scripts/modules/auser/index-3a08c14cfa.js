"use strict";angular.module("sbAdminApp",[]).controller("auserCtrl",["$scope","$rootScope","baseService",function(e,a,s){e.displayed=[],e.sp={},e.tableState={},e.currentGroup=a.rootGroup,e.sp.oid=e.currentGroup.id,e.callServer=function(a){s.initTable(e,a,s.api.installUser+"getInstallUserPageList")},e.initPage=function(){e.tableState.pagination.start=0,e.callServer(e.tableState)},e.$on("emitGroupLeaf",function(a,s){e.sp.oid!=s.id&&(e.currentGroup=s,e.sp.oid=s.id,e.initPage())}),e.save=function(a){var t={id:a?a.id:"",phone:a?a.phone:"",password:a?a.password:"",name:a?a.name:"",oid:a?a.oid:""};s.confirmDialog(540,a?"编辑账号":"添加账号",t,"tpl/auser_save.html",function(t,o){if(o.isShowMessage=!1,o.modalForm.$valid){var i={id:a?a.id:"",phone:o.data.phone,password:o.data.password,name:o.data.name,oid:o.currentGroup.id};a||(i.password=s.md5_pwd(i.password)),o.isPosting=!0,s.postData(s.api.installUser+"saveInstallUser",i,function(){t.close(),s.alert(a?"修改成功":"添加成功","success"),e.callServer(e.tableState)})}else o.isShowMessage=!0},function(e){e.$on("emitGroupLeaf",function(a,s,t){e.currentGroup=s,e.currentGroup.id=s.id})})},e.resetPwd=function(a){s.confirmDialog(540,"重置密码",{},"tpl/reset_password.html",function(t,o){o.modalForm.$valid?(o.isPosting=!0,s.postData(s.api.installUser+"resetInstallUserPassword",{id:a.id,password:s.md5_pwd(o.data.password)},function(){t.close(),s.alert("修改成功","success"),e.callServer(e.tableState)})):o.isShowMessage=!0})},e.del=function(a){s.confirm("删除","您确定删除安装人员："+a.name+"?",function(t,o){o.isPosting=!0,s.postData(s.api.installUser+"deleteInstallUser",{id:a.id},function(a){t.close(),s.alert("删除成功","success"),e.callServer(e.tableState)})})}}]);